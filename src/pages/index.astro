---
import Layout from '../layouts/Layout.astro';

// UI
import ButtonPrimary from '../components/ui/ButtonPrimary.astro';
import ButtonSecondary from '../components/ui/ButtonSecondary.astro';
import StatusIndicator from '../components/ui/StatusIndicator.astro';
import Divider from '../components/ui/Divider.astro';

// Nav
import Logo from '../components/nav/Logo.astro';
import NavItem from '../components/nav/NavItem.astro';
import HeaderBar from '../components/nav/HeaderBar.astro';
import Footer from '../components/nav/Footer.astro';

// Content
import SectionHeader from '../components/content/SectionHeader.astro';
import TerminalWindow from '../components/content/TerminalWindow.astro';
import SkillBar from '../components/content/SkillBar.astro';
import ProjectCard from '../components/content/ProjectCard.astro';
---

<Layout title="florian_dev — portfolio">
  <!-- Header -->
  <HeaderBar>
    <Logo name="florian_dev" slot="logo" />
    <Fragment slot="nav">
      <NavItem label="about" href="#about" active />
      <NavItem label="projects" href="#projects" />
      <NavItem label="skills" href="#skills" />
      <NavItem label="contact" href="#contact" />
    </Fragment>
    <StatusIndicator text="building things" slot="status" />
  </HeaderBar>

  <!-- Hero Section -->
  <section id="about" class="flex flex-col items-center gap-10 bg-bg-page px-16 pt-[120px] pb-[100px]">
    <div class="w-full max-w-[900px]">
      <TerminalWindow title="~/florian_dev — bash">
        <div id="hero-terminal">
          <p data-type="cmd" class="text-sm font-medium text-green-primary hidden">$ whoami</p>
          <p data-type="out" class="text-sm text-text-primary hidden">florian riquelme — senior software engineer</p>
          <div data-type="out" class="h-3 hidden"></div>
          <p data-type="cmd" class="text-sm font-medium text-green-primary hidden">$ cat intro.txt</p>
          <p data-type="out" class="text-sm text-text-secondary hidden">Product-focused engineer with 9+ years of building web platforms</p>
          <p data-type="out" class="text-sm text-text-secondary hidden">I embrace ai-powered workflows to move fast without compromise.</p>
          <p data-type="out" class="text-sm text-text-secondary hidden">Focus on what matters: products people actually enjoy using.</p>
          <p data-type="out" class="text-sm text-text-secondary hidden">Currently crafting digital products at digital-masters.</p>
          <div data-type="out" class="h-3 hidden"></div>
          <p data-type="cmd" class="text-sm font-medium text-green-primary hidden">$ echo $current_stack</p>
          <p data-type="out" class="text-sm text-text-primary hidden">php · react · typescript · go</p>
          <div data-type="out" class="h-3 hidden"></div>
          <p data-type="cmd" class="text-sm font-medium text-green-primary hidden">$ echo $experience</p>
          <p data-type="out" class="text-sm text-text-primary hidden">9+ years of experience</p>
          <div data-type="out" class="h-4 hidden"></div>
          <div id="hero-cursor" class="flex items-center hidden">
            <span class="text-sm font-medium text-green-primary">$ </span>
            <span class="h-[18px] w-[9px] bg-green-primary animate-blink"></span>
          </div>
        </div>
      </TerminalWindow>
    </div>

    <!-- Hero Bottom -->
    <div id="hero-bottom" class="flex flex-col items-center gap-8 w-full max-w-[900px] opacity-0 transition-opacity duration-700">
      <h1 class="text-4xl font-semibold text-text-primary text-center">
        building the future, one commit at a time.
      </h1>
      <p class="text-sm text-text-tertiary text-center">
        // senior software engineer · product-focused · ai-driven development
      </p>
      <div class="flex items-center gap-4">
        <ButtonPrimary label="view_projects" icon="lucide:terminal" href="#projects" />
        <ButtonSecondary label="github_profile" icon="lucide:github" href="https://github.com/FlorianRiquelme" />
      </div>
    </div>
  </section>

  <Divider />

  <!-- Skills Section -->
  <section id="skills" class="flex flex-col gap-12 bg-bg-page px-16 py-20">
    <SectionHeader
      command="$ neofetch --skills"
      description="// system capabilities and proficiency levels"
    />
    <div class="grid grid-cols-1 gap-6 md:grid-cols-3">
      <!-- Frontend -->
      <div class="flex flex-col gap-4 stagger-1" data-animate>
        <span class="text-sm font-medium text-text-primary">frontend:</span>
        <SkillBar name="react / next.js" percentage={95} />
        <SkillBar name="typescript" percentage={100} />
        <SkillBar name="tailwind css" percentage={90} />
      </div>
      <!-- Backend -->
      <div class="flex flex-col gap-4 stagger-2" data-animate>
        <span class="text-sm font-medium text-text-primary">backend:</span>
        <SkillBar name="php" percentage={100} />
        <SkillBar name="node.js" percentage={95} />
        <SkillBar name="go" percentage={85} />
      </div>
      <!-- DevOps -->
      <div class="flex flex-col gap-4 stagger-3" data-animate>
        <span class="text-sm font-medium text-text-primary">devops:</span>
        <SkillBar name="aws" percentage={100} />
        <SkillBar name="docker" percentage={95} />
        <SkillBar name="ci pipelines" percentage={100} />
      </div>
    </div>
  </section>

  <Divider />

  <!-- Projects Section -->
  <section id="projects" class="flex flex-col gap-12 bg-bg-page px-16 py-20">
    <div class="flex items-end justify-between">
      <SectionHeader
        command="$ ls -la ~/projects"
        description="// selected works and open source contributions"
      />
      <span class="text-xs text-text-muted">total: 2 projects</span>
    </div>
    <div class="grid grid-cols-1 gap-5 md:grid-cols-2">
      <div data-animate class="stagger-1">
        <ProjectCard
          title="cashmunk"
          description="// privacy-first envelope budgeting app for ios. your data stays on your device, pay once, own forever."
          link="https://cashmunk.app/"
          tags={['swift', 'ios', 'privacy']}
        >
          <div slot="image" class="h-full w-full bg-gradient-to-br from-green-primary/20 to-bg-surface"></div>
        </ProjectCard>
      </div>
      <div data-animate class="stagger-2">
        <ProjectCard
          title="ddev-claude"
          description="// ddev plugin for running claude code in sandboxed, firewalled containers"
          link="https://github.com/FlorianRiquelme/ddev-claude"
          tags={['ddev', 'docker', 'claude']}
        >
          <div slot="image" class="h-full w-full bg-gradient-to-br from-blue-info/20 to-bg-surface"></div>
        </ProjectCard>
      </div>
    </div>
  </section>

  <Divider />

  <!-- Contact Section -->
  <section id="contact" class="flex flex-col items-center gap-12 bg-bg-page px-16 py-20">
    <div class="flex flex-col items-center gap-2">
      <h2 class="text-[28px] font-semibold text-green-primary">$ ping florian_dev</h2>
      <p class="text-[13px] text-text-tertiary text-center">
        // always open to interesting conversations and collaborations
      </p>
    </div>

    <div id="contact-terminal-wrapper" class="w-full max-w-[700px]">
      <TerminalWindow title="~/contact — bash">
        <div id="contact-terminal">
          <p data-type="cmd" class="text-[13px] font-medium text-green-primary hidden">$ cat contact_info.json</p>
          <p data-type="out" class="text-[13px] text-text-muted whitespace-pre hidden">{"{"}</p>
          <p data-type="out" class="text-[13px] text-text-secondary whitespace-pre hidden">  "email":    "flo@friquelme.dev",</p>
          <p data-type="out" class="text-[13px] text-text-secondary whitespace-pre hidden">  "github":   "github.com/FlorianRiquelme",</p>
          <p data-type="out" class="text-[13px] text-text-secondary whitespace-pre hidden">  "linkedin": "linkedin.com/in/florian-riquelme",</p>
          <p data-type="out" class="text-[13px] text-text-secondary whitespace-pre hidden">  "location": "hamburg, germany"</p>
          <p data-type="out" class="text-[13px] text-text-muted whitespace-pre hidden">{"}"}</p>
          <div data-type="out" class="h-2 hidden"></div>
          <div id="contact-cursor" class="flex items-center hidden">
            <span class="text-[13px] font-medium text-green-primary">$ </span>
            <span class="h-4 w-[9px] bg-green-primary animate-blink"></span>
          </div>
        </div>
      </TerminalWindow>
    </div>

    <ButtonPrimary label="send_message" icon="lucide:mail" href="mailto:flo@friquelme.dev" />
  </section>

  <Divider />

  <!-- Footer -->
  <Footer brandName="florian_dev" copyright="// designed & built by florian riquelme © 2026">
    <Fragment slot="links">
      <a href="https://github.com/FlorianRiquelme" class="text-xs text-text-tertiary hover:text-text-secondary transition">github</a>
      <a href="https://linkedin.com/in/florian-riquelme" class="text-xs text-text-tertiary hover:text-text-secondary transition">linkedin</a>
    </Fragment>
  </Footer>
</Layout>

<script>
  const reduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  function sleep(ms: number) {
    return new Promise((r) => setTimeout(r, ms));
  }

  async function typeText(el: HTMLElement) {
    const text = el.textContent || '';
    el.textContent = '';
    el.classList.remove('hidden');
    for (const char of text) {
      el.textContent += char;
      await sleep(40);
    }
  }

  async function runTerminalSequence(containerId: string, cursorId: string) {
    const lines = document.querySelectorAll<HTMLElement>(`#${containerId} [data-type]`);
    const cursor = document.getElementById(cursorId);

    for (const line of lines) {
      if (line.dataset.type === 'cmd') {
        await typeText(line);
        await sleep(200);
      } else {
        line.classList.remove('hidden');
        await sleep(50);
      }
    }
    cursor?.classList.remove('hidden');
  }

  function showTerminalAll(containerId: string, cursorId: string) {
    document.querySelectorAll<HTMLElement>(`#${containerId} [data-type]`)
      .forEach((el) => el.classList.remove('hidden'));
    document.getElementById(cursorId)?.classList.remove('hidden');
  }

  // Hero terminal — runs immediately on load
  const heroBottom = document.getElementById('hero-bottom');

  if (reduced) {
    showTerminalAll('hero-terminal', 'hero-cursor');
    showTerminalAll('contact-terminal', 'contact-cursor');
    if (heroBottom) heroBottom.style.opacity = '1';
  } else {
    runTerminalSequence('hero-terminal', 'hero-cursor').then(async () => {
      await sleep(300);
      if (heroBottom) heroBottom.style.opacity = '1';
    });

    // Contact terminal — triggered on scroll
    const contactWrapper = document.getElementById('contact-terminal-wrapper');
    if (contactWrapper) {
      const contactObserver = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (!entry.isIntersecting) return;
            contactObserver.unobserve(entry.target);
            runTerminalSequence('contact-terminal', 'contact-cursor');
          });
        },
        { threshold: 0.3 }
      );
      contactObserver.observe(contactWrapper);
    }
  }
</script>
