---
import Layout from '../layouts/Layout.astro';

// UI
import ButtonPrimary from '../components/ui/ButtonPrimary.astro';
import ButtonSecondary from '../components/ui/ButtonSecondary.astro';
import StatusIndicator from '../components/ui/StatusIndicator.astro';
import Divider from '../components/ui/Divider.astro';

// Nav
import Logo from '../components/nav/Logo.astro';
import NavItem from '../components/nav/NavItem.astro';
import HeaderBar from '../components/nav/HeaderBar.astro';
import Footer from '../components/nav/Footer.astro';

// Content
import SectionHeader from '../components/content/SectionHeader.astro';
import TerminalWindow from '../components/content/TerminalWindow.astro';
import SkillBar from '../components/content/SkillBar.astro';
import ProjectCard from '../components/content/ProjectCard.astro';

---

<Layout title="Florian Riquelme — Senior Software Engineer | PHP, React, TypeScript, AWS" description="Florian Riquelme — senior software engineer. Product-focused, AI-driven development. PHP, React, TypeScript, Go, AWS.">
  <!-- Header -->
  <HeaderBar>
    <Logo name="friquelme.dev" slot="logo" />
    <Fragment slot="nav">
      <NavItem label="about" href="#about" active />
      <NavItem label="projects" href="#projects" />
      <NavItem label="skills" href="#skills" />
      <NavItem label="blog" href="/blog" />
      <NavItem label="contact" href="#contact" />
    </Fragment>
    <StatusIndicator text="building things" slot="status" />
  </HeaderBar>

  <!-- Hero Section -->
  <section id="about" class="flex flex-col items-center gap-8 bg-bg-page px-5 pt-20 pb-16 md:gap-10 md:px-16 md:pt-[120px] md:pb-[100px]">
    <div class="w-full max-w-[900px]">
      <TerminalWindow title="~/friquelme.dev — bash">
        <div id="hero-terminal">
          <p data-type="cmd" class="text-sm font-medium text-green-primary hidden">$ whoami</p>
          <p data-type="out" class="text-sm text-text-primary hidden">florian riquelme — senior software engineer</p>
          <div data-type="out" class="h-3 hidden"></div>
          <p data-type="cmd" class="text-sm font-medium text-green-primary hidden">$ cat intro.txt</p>
          <p data-type="out" class="text-sm text-text-secondary hidden">9+ years shipping saas platforms, e-commerce, and web apps.</p>
          <p data-type="out" class="text-sm text-text-secondary hidden">i pair ai-driven workflows with clean code to ship fast and ship right.</p>
          <p data-type="out" class="text-sm text-text-secondary hidden">full-stack across the board — react frontends to aws infrastructure.</p>
          <p data-type="out" class="text-sm text-text-secondary hidden">currently building at digital-masters, a full-service digital agency.</p>
          <div data-type="out" class="h-3 hidden"></div>
          <p data-type="cmd" class="text-sm font-medium text-green-primary hidden">$ echo $current_stack</p>
          <p data-type="out" class="text-sm text-text-primary hidden">php · react · typescript · go</p>
          <div data-type="out" class="h-3 hidden"></div>
          <p data-type="cmd" class="text-sm font-medium text-green-primary hidden">$ echo $experience</p>
          <p data-type="out" class="text-sm text-text-primary hidden">9+ years of experience</p>
          <div data-type="out" class="h-4 hidden"></div>
          <div id="hero-cursor" class="flex items-center hidden">
            <span class="text-sm font-medium text-green-primary">$ </span>
            <span class="h-[18px] w-[9px] bg-green-primary animate-blink"></span>
          </div>
        </div>
      </TerminalWindow>
    </div>

    <!-- Hero Bottom -->
    <div id="hero-bottom" class="flex flex-col items-center gap-8 w-full max-w-[900px] opacity-0 transition-opacity duration-700">
      <div class="sr-only">
        <p>Florian Riquelme — Senior Software Engineer. 9+ years shipping SaaS platforms, e-commerce, and web apps. Full-stack: PHP, React, TypeScript, Go, AWS. Currently at digital-masters in Hamburg, Germany.</p>
      </div>
      <h1 class="text-2xl font-semibold text-text-primary text-center md:text-4xl">
        shipping products, not just writing code.
      </h1>
      <p class="text-sm text-text-tertiary text-center">
        // senior software engineer · full-stack · ai-driven development
      </p>
      <div class="flex flex-col items-center gap-3 w-full sm:flex-row sm:gap-4 sm:w-auto">
        <ButtonPrimary label="read_blog" icon="lucide:file-text" href="/blog" />
        <ButtonSecondary label="github_profile" icon="lucide:github" href="https://github.com/FlorianRiquelme" />
      </div>
    </div>
  </section>

  <Divider />

  <!-- Skills Section -->
  <section id="skills" class="flex flex-col gap-8 bg-bg-page px-5 py-12 md:gap-12 md:px-16 md:py-20">
    <SectionHeader
      command="$ neofetch --skills"
      description="// what i ship with daily"
    />
    <div class="grid grid-cols-1 gap-6 md:grid-cols-3">
      <!-- Frontend -->
      <div class="flex flex-col gap-4 stagger-1" data-animate>
        <span class="text-sm font-medium text-text-primary">frontend:</span>
        <SkillBar name="typescript" percentage={100} />
        <SkillBar name="react / next.js" percentage={95} />
        <SkillBar name="tailwind css" percentage={90} />
      </div>
      <!-- Backend -->
      <div class="flex flex-col gap-4 stagger-2" data-animate>
        <span class="text-sm font-medium text-text-primary">backend:</span>
        <SkillBar name="php" percentage={100} />
        <SkillBar name="node.js" percentage={95} />
        <SkillBar name="go" percentage={85} />
      </div>
      <!-- DevOps -->
      <div class="flex flex-col gap-4 stagger-3" data-animate>
        <span class="text-sm font-medium text-text-primary">devops:</span>
        <SkillBar name="aws" percentage={100} />
        <SkillBar name="ci pipelines" percentage={100} />
        <SkillBar name="docker" percentage={95} />
      </div>
    </div>
  </section>

  <Divider />

  <!-- Projects Section -->
  <section id="projects" class="flex flex-col gap-8 bg-bg-page px-5 py-12 md:gap-12 md:px-16 md:py-20">
    <div class="flex flex-col gap-2 md:flex-row md:items-end md:justify-between">
      <SectionHeader
        command="$ ls -la ~/projects"
        description="// side projects & open source"
      />
      <span class="text-xs text-text-muted">2 active</span>
    </div>
    <div class="grid grid-cols-1 gap-5 md:grid-cols-2">
      <div data-animate class="stagger-1">
        <ProjectCard
          title="cashmunk"
          description="// privacy-first envelope budgeting app for ios. your data stays on your device, pay once, own forever."
          link="https://cashmunk.app/"
          tags={['swift', 'ios', 'privacy']}
        />
      </div>
      <div data-animate class="stagger-2">
        <ProjectCard
          title="ddev-claude"
          description="// ddev plugin for running claude code in sandboxed, firewalled containers"
          link="https://github.com/FlorianRiquelme/ddev-claude"
          tags={['ddev', 'docker', 'claude']}
        />
      </div>
    </div>
  </section>

  <Divider />

  <!-- Contact Section -->
  <section id="contact" class="flex flex-col items-center gap-8 bg-bg-page px-5 py-12 md:gap-12 md:px-16 md:py-20">
    <div class="flex flex-col items-center gap-2">
      <h2 class="text-xl font-semibold text-green-primary md:text-[28px]">$ ping friquelme.dev</h2>
      <p class="text-[13px] text-text-tertiary text-center">
        // open to open-source collabs, side projects, and dev conversations
      </p>
    </div>

    <div id="contact-terminal-wrapper" class="w-full max-w-[700px]">
      <TerminalWindow title="~/contact — bash">
        <div id="contact-terminal">
          <p data-type="cmd" class="text-[13px] font-medium text-green-primary hidden">$ cat contact_info.json</p>
          <p data-type="out" class="text-[13px] text-text-muted whitespace-pre-wrap hidden">{"{"}</p>
          <p data-type="out" class="text-[13px] text-text-secondary whitespace-pre-wrap break-all hidden">  "email":    "flo@friquelme.dev",</p>
          <p data-type="out" class="text-[13px] text-text-secondary whitespace-pre-wrap break-all hidden">  "github":   "github.com/FlorianRiquelme",</p>
          <p data-type="out" class="text-[13px] text-text-secondary whitespace-pre-wrap break-all hidden">  "linkedin": "linkedin.com/in/florian-riquelme",</p>
          <p data-type="out" class="text-[13px] text-text-secondary whitespace-pre-wrap break-all hidden">  "location": "hamburg, germany"</p>
          <p data-type="out" class="text-[13px] text-text-muted whitespace-pre-wrap hidden">{"}"}</p>
          <div data-type="out" class="h-2 hidden"></div>
          <div id="contact-cursor" class="flex items-center hidden">
            <span class="text-[13px] font-medium text-green-primary">$ </span>
            <span class="h-4 w-[9px] bg-green-primary animate-blink"></span>
          </div>
        </div>
      </TerminalWindow>
    </div>

    <ButtonPrimary label="send_message" icon="lucide:mail" href="mailto:flo@friquelme.dev" />
  </section>

  <Divider />

  <!-- Footer -->
  <Footer brandName="friquelme.dev" copyright="// designed & built by florian riquelme © 2026">
    <Fragment slot="links">
      <a href="https://github.com/FlorianRiquelme" class="text-xs text-text-tertiary hover:text-text-secondary transition">github</a>
      <a href="https://linkedin.com/in/florian-riquelme" class="text-xs text-text-tertiary hover:text-text-secondary transition">linkedin</a>
      <a href="https://github.com/FlorianRiquelme/friquelme.dev" class="text-xs text-text-tertiary hover:text-green-primary transition">view source</a>
    </Fragment>
  </Footer>
</Layout>

<script>
  const reduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  function sleep(ms: number) {
    return new Promise((r) => setTimeout(r, ms));
  }

  async function typeText(el: HTMLElement) {
    const text = el.textContent || '';
    el.textContent = '';
    el.classList.remove('hidden');
    for (const char of text) {
      el.textContent += char;
      await sleep(40);
    }
  }

  async function runTerminalSequence(containerId: string, cursorId: string) {
    const lines = document.querySelectorAll<HTMLElement>(`#${containerId} [data-type]`);
    const cursor = document.getElementById(cursorId);

    for (const line of lines) {
      if (line.dataset.type === 'cmd') {
        await typeText(line);
        await sleep(200);
      } else {
        line.classList.remove('hidden');
        await sleep(50);
      }
    }
    cursor?.classList.remove('hidden');
  }

  function showTerminalAll(containerId: string, cursorId: string) {
    document.querySelectorAll<HTMLElement>(`#${containerId} [data-type]`)
      .forEach((el) => el.classList.remove('hidden'));
    document.getElementById(cursorId)?.classList.remove('hidden');
  }

  // Hero terminal — runs immediately on load
  const heroBottom = document.getElementById('hero-bottom');

  if (reduced) {
    showTerminalAll('hero-terminal', 'hero-cursor');
    showTerminalAll('contact-terminal', 'contact-cursor');
    if (heroBottom) heroBottom.style.opacity = '1';
  } else {
    runTerminalSequence('hero-terminal', 'hero-cursor').then(async () => {
      await sleep(300);
      if (heroBottom) heroBottom.style.opacity = '1';
    });

    // Contact terminal — triggered on scroll
    const contactWrapper = document.getElementById('contact-terminal-wrapper');
    if (contactWrapper) {
      const contactObserver = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (!entry.isIntersecting) return;
            contactObserver.unobserve(entry.target);
            runTerminalSequence('contact-terminal', 'contact-cursor');
          });
        },
        { threshold: 0.3 }
      );
      contactObserver.observe(contactWrapper);
    }
  }
</script>

<script type="application/ld+json" set:html={JSON.stringify({
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebSite",
      "name": "friquelme.dev",
      "url": "https://friquelme.dev"
    },
    {
      "@type": "Person",
      "name": "Florian Riquelme",
      "url": "https://friquelme.dev",
      "jobTitle": "Senior Software Engineer",
      "sameAs": [
        "https://github.com/FlorianRiquelme",
        "https://linkedin.com/in/florian-riquelme"
      ],
      "knowsAbout": ["PHP", "React", "TypeScript", "Go", "AWS"]
    }
  ]
})} />
